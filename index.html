<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P√°tio Pro Elite - IA Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --main-color: #2563eb; }
        body { -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-button.active { color: var(--main-color); background: #eff6ff; border-radius: 15px; }
        #bloqueio, #modal-saida, #modal-os { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 100%; max-width: 450px; border-radius: 30px; padding: 25px; max-height: 90vh; overflow-y: auto; }
        .os-print { font-family: 'Courier New', Courier, monospace; border: 2px solid #000; padding: 20px; color: black; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-28 text-gray-800 font-sans">

    <div id="modal-os" onclick="this.style.display='none'">
        <div class="modal-content os-print" onclick="event.stopPropagation()">
            <div id="conteudo-os"></div>
            <button onclick="window.print()" class="mt-4 w-full bg-black text-white py-3 rounded-xl font-bold uppercase">Imprimir / PDF</button>
            <button onclick="document.getElementById('modal-os').style.display='none'" class="mt-2 w-full text-gray-400 text-xs font-bold uppercase">Fechar</button>
        </div>
    </div>

    <div id="bloqueio">
        <div class="modal-content text-center">
            <h2 class="text-xl font-bold mb-4 uppercase text-blue-700">Ativa√ß√£o</h2>
            <input type="password" id="senha-licenca" placeholder="Senha 0907" class="border-2 p-4 rounded-xl w-full mb-4 text-center outline-none">
            <button onclick="verificarSenha()" class="bg-blue-600 text-white w-full py-4 rounded-xl font-bold uppercase">Acessar</button>
        </div>
    </div>

    <header class="bg-blue-700 text-white p-5 shadow-lg sticky top-0 z-50 rounded-b-2xl">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-black italic uppercase">P√ÅTIO PRO ELITE</h1>
            <span id="contador" class="bg-blue-900 px-3 py-1 rounded-full text-[10px] font-bold uppercase">0 VE√çCULOS</span>
        </div>
    </header>

    <main class="p-4 max-w-xl mx-auto space-y-4">
        
        <section id="aba-entrada" class="tab-content active">
            <div class="bg-white p-6 rounded-3xl shadow-md border">
                <form id="form-entrada" class="space-y-4">
                    <input type="text" id="input-data-entrada" required class="w-full bg-gray-50 border-2 p-3 rounded-2xl text-center font-bold">
                    <input type="text" id="placa" placeholder="PLACA" required class="w-full bg-gray-50 border-2 p-4 rounded-2xl font-black text-xl text-center uppercase">
                    <input type="text" id="modelo" placeholder="MODELO / MARCA" required class="w-full bg-gray-50 border-2 p-4 rounded-2xl font-bold uppercase">
                    <input type="text" id="cliente" placeholder="NOME DO CLIENTE" required class="w-full bg-gray-50 border-2 p-4 rounded-2xl font-bold uppercase">
                    <input type="tel" id="telefone" placeholder="WHATSAPP" required class="w-full bg-gray-50 border-2 p-4 rounded-2xl font-bold">
                    
                    <div id="container-previa" class="hidden w-full h-40 rounded-2xl overflow-hidden border-2 mb-4">
                        <img id="img-previa" class="w-full h-full object-cover">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex flex-col items-center justify-center border-2 border-blue-200 p-4 rounded-2xl text-blue-600 bg-blue-50 cursor-pointer">
                            <span class="font-bold text-[10px] uppercase">üì∏ Foto Entrada</span>
                            <input type="file" accept="image/*" capture="environment" class="hidden" onchange="processarFoto(this, 'entrada')">
                        </label>
                        <button type="submit" class="bg-blue-600 text-white font-black p-5 rounded-2xl shadow-lg uppercase">Registrar</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="aba-patio" class="tab-content">
            <div id="lista-veiculos" class="space-y-6"></div>
        </section>

        <section id="aba-estoque" class="tab-content">
            <div id="lista-estoque" class="space-y-3"></div>
        </section>
        <section id="aba-orcamento" class="tab-content">
            <div id="lista-orcamento" class="space-y-3"></div>
        </section>
        <section id="aba-relatorio" class="tab-content">
            <div id="lista-relatorio" class="space-y-3"></div>
        </section>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center h-24 z-50 px-2 shadow-2xl">
        <button onclick="mudarAba('entrada')" id="btn-nav-entrada" class="nav-button active flex flex-col items-center p-2"><span class="text-xl">‚ûï</span><span class="text-[7px] font-bold mt-1 uppercase">Entrada</span></button>
        <button onclick="mudarAba('patio')" id="btn-nav-patio" class="nav-button flex flex-col items-center p-2"><span class="text-xl">üöó</span><span class="text-[7px] font-bold mt-1 uppercase">P√°tio</span></button>
        <button onclick="mudarAba('estoque')" id="btn-nav-estoque" class="nav-button flex flex-col items-center p-2"><span class="text-xl">üì¶</span><span class="text-[7px] font-bold mt-1 uppercase">Estoque</span></button>
        <button onclick="mudarAba('orcamento')" id="btn-nav-orcamento" class="nav-button flex flex-col items-center p-2"><span class="text-xl">üí∞</span><span class="text-[7px] font-bold mt-1 uppercase">Or√ßam.</span></button>
        <button onclick="mudarAba('relatorio')" id="btn-nav-relatorio" class="nav-button flex flex-col items-center p-2"><span class="text-xl">üìã</span><span class="text-[7px] font-bold mt-1 uppercase">Relat.</span></button>
    </nav>

    <script>
        let patio = JSON.parse(localStorage.getItem('patio_data')) || [];
        let historico = JSON.parse(localStorage.getItem('patio_historico')) || [];
        let tempFotoEntrada = null;

        document.getElementById('input-data-entrada').value = new Date().toLocaleDateString('pt-BR');

        function mudarAba(aba) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.getElementById('aba-' + aba).classList.add('active');
            document.getElementById('btn-nav-' + aba).classList.add('active');
            renderizar();
        }

        function processarFoto(input, tipo, id = null) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 400;
                        canvas.height = img.height * (400 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const base64 = canvas.toDataURL('image/jpeg', 0.6);
                        
                        if (tipo === 'entrada') {
                            tempFotoEntrada = base64;
                            document.getElementById('img-previa').src = base64;
                            document.getElementById('container-previa').classList.remove('hidden');
                        } else {
                            const veiculo = patio.find(v => v.id === id);
                            veiculo.fotoDepois = base64;
                            localStorage.setItem('patio_data', JSON.stringify(patio));
                            renderizar();
                        }
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        document.getElementById('form-entrada').addEventListener('submit', (e) => {
            e.preventDefault();
            const novo = {
                id: Date.now(),
                placa: document.getElementById('placa').value.toUpperCase(),
                modelo: document.getElementById('modelo').value.toUpperCase(),
                cliente: document.getElementById('cliente').value.toUpperCase(),
                telefone: document.getElementById('telefone').value,
                fotoAntes: tempFotoEntrada,
                fotoDepois: null,
                entrada: document.getElementById('input-data-entrada').value,
                servicos: ""
            };
            patio.unshift(novo);
            localStorage.setItem('patio_data', JSON.stringify(patio));
            tempFotoEntrada = null;
            location.reload();
        });

        function salvarEdicao(id, campo, valor) {
            const index = patio.findIndex(v => v.id === id);
            patio[index][campo] = valor.toUpperCase();
            localStorage.setItem('patio_data', JSON.stringify(patio));
        }

        function gerarOS(id) {
            const v = patio.find(v => v.id === id);
            const conteudo = `
                <center><strong>P√ÅTIO PRO ELITE - O.S</strong></center>
                <hr>
                <p>DATA: ${v.entrada}</p>
                <p>CLIENTE: ${v.cliente}</p>
                <p>VE√çCULO: ${v.modelo} (${v.placa})</p>
                <p>WHATSAPP: ${v.telefone}</p>
                <hr>
                <p><strong>SERVI√áOS REALIZADOS:</strong></p>
                <p>${v.servicos || 'Nenhum servi√ßo registrado'}</p>
                <br><br>
                <p align="center">_________________________<br>Assinatura Cliente</p>
            `;
            document.getElementById('conteudo-os').innerHTML = conteudo;
            document.getElementById('modal-os').style.display = 'flex';
        }

        function renderizar() {
            const listaPatio = document.getElementById('lista-veiculos');
            listaPatio.innerHTML = '';
            document.getElementById('contador').innerText = patio.length + " VE√çCULOS";

            patio.forEach(v => {
                listaPatio.innerHTML += `
                    <div class="bg-white p-5 rounded-3xl shadow-lg border-2 border-blue-100 space-y-4">
                        <div class="flex justify-between items-center border-b pb-2">
                            <input onchange="salvarEdicao(${v.id}, 'placa', this.value)" value="${v.placa}" class="font-black text-xl w-32 outline-none text-blue-700">
                            <span class="text-[10px] font-bold text-gray-400">ID: ${v.id}</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>
                                <label class="text-[9px] font-bold text-gray-400 uppercase">Modelo</label>
                                <input onchange="salvarEdicao(${v.id}, 'modelo', this.value)" value="${v.modelo}" class="w-full font-bold outline-none">
                            </div>
                            <div>
                                <label class="text-[9px] font-bold text-gray-400 uppercase">Cliente</label>
                                <input onchange="salvarEdicao(${v.id}, 'cliente', this.value)" value="${v.cliente}" class="w-full font-bold outline-none">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <span class="text-[9px] font-bold uppercase text-gray-400">üì∏ ANTES</span>
                                <img src="${v.fotoAntes || ''}" class="w-full h-24 object-cover rounded-xl bg-gray-100 border">
                            </div>
                            <div class="space-y-1">
                                <span class="text-[9px] font-bold uppercase text-gray-400">üì∏ DEPOIS</span>
                                <label class="block w-full h-24 rounded-xl border-2 border-dashed border-blue-200 flex items-center justify-center cursor-pointer overflow-hidden">
                                    ${v.fotoDepois ? `<img src="${v.fotoDepois}" class="w-full h-full object-cover">` : '<span class="text-blue-500 text-xl">+</span>'}
                                    <input type="file" accept="image/*" capture="environment" class="hidden" onchange="processarFoto(this, 'depois', ${v.id})">
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="text-[9px] font-bold text-gray-400 uppercase">Servi√ßos / Observa√ß√µes</label>
                            <textarea onchange="salvarEdicao(${v.id}, 'servicos', this.value)" class="w-full bg-yellow-50 p-2 rounded-xl text-xs font-medium border-none outline-none" placeholder="Descreva os servi√ßos...">${v.servicos || ''}</textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="gerarOS(${v.id})" class="bg-black text-white py-3 rounded-xl font-black text-[10px] uppercase shadow-md">Gerar O.S</button>
                            <button onclick="darSaida(${v.id})" class="bg-green-600 text-white py-3 rounded-xl font-black text-[10px] uppercase shadow-md">Finalizar</button>
                        </div>
                    </div>`;
            });
        }

        function darSaida(id) {
            const v = patio.find(v => v.id === id);
            historico.unshift({...v, dataSaida: new Date().toLocaleDateString()});
            localStorage.setItem('patio_historico', JSON.stringify(historico));
            patio = patio.filter(v => v.id !== id);
            localStorage.setItem('patio_data', JSON.stringify(patio));
            renderizar();
        }

        function verificarSenha() {
            if (document.getElementById('senha-licenca').value === "0907") {
                localStorage.setItem('data_ativacao', Date.now());
                document.getElementById('bloqueio').style.display = 'none';
            } else alert("Incorreto");
        }

        mudarAba('entrada');
    </script>
</body>
</html>
